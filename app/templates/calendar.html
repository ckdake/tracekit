{% extends "base.html" %}
{% block title %}tracekit Sync Calendar{% endblock %}

{% block body %}
<div class="container-wide">
    <div class="cal-header">
        <h1>üìÖ tracekit Sync Calendar</h1>
        <p>Provider sync status by month</p>
    </div>

    {% include 'partials/_nav.html' %}

    {% if shell_data.error %}
    <div class="error">
        <h3>‚ùå Database Error</h3>
        <p><strong>Error:</strong> {{ shell_data.error }}</p>
    </div>
    {% elif not shell_data.months %}
    <div class="error"><p>No sync data found in the database.</p></div>
    {% else %}

    <div class="calendar-grid">
        {% for month in shell_data.months %}
        <div class="month-card {% if month.year_month == current_month %}current{% endif %}"
             id="card-{{ month.year_month }}">
            <div class="month-header">
                <div class="month-title-row">
                    <span>{{ month.month_name }} {{ month.year }}</span>
                    <div class="month-btn-group">
                        <button class="pull-btn" data-month="{{ month.year_month }}"
                                onclick="pullMonth(this)" title="Pull">‚¨á</button>
                        <button class="reset-btn" data-month="{{ month.year_month }}"
                                onclick="resetMonth(this)" title="Reset month data">‚Ü∫</button>
                    </div>
                </div>
                <div class="total-label" id="total-{{ month.year_month }}"></div>
            </div>
            <div class="provider-grid" id="grid-{{ month.year_month }}">
                <div class="card-loading">Loading‚Ä¶</div>
            </div>
            <div class="pull-status" id="status-{{ month.year_month }}"></div>
        </div>
        {% endfor %}
    </div>

    <div class="cal-stats">
        <h3>üìä Summary</h3>
        <p><strong>Date Range:</strong> {{ shell_data.date_range[0] }} to {{ shell_data.date_range[1] }}</p>
        <p><strong>Total Months:</strong> {{ shell_data.total_months }}</p>
        <p><strong>Providers:</strong> {{ shell_data.providers|length }}</p>
        <p><strong>Provider List:</strong> {{ shell_data.providers|join(', ') }}</p>
    </div>

    {% endif %}
</div>

<script>const PROVIDER_CONFIG = {{ (config.providers or {})|tojson }};</script>
<script src="{{ url_for('static', filename='calendar.js') }}"></script>
{% endblock %}
